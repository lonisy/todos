<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Todo List with Sorting</title>
    <!-- Vue 2.x -->
    <script src="assets/js/vue.js"></script>
    <!-- SortableJS & VueDraggable for Drag and Drop -->
    <script src="assets/js/Sortable.min.js"></script>
    <script src="assets/js/vuedraggable.umd.min.js"></script>
    <!--    <script src="https://cdn.jsdelivr.net/npm/vuedraggable@2.24.3/dist/vuedraggable.umd.min.js"></script>-->
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?7b1742c43602c4ba1080845e597532e4";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19122908-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'UA-19122908-1');
    </script>
    <style>
        /* Base TodoMVC CSS */
        :focus { outline: 0; }
        [v-cloak] { display: none; }

        html, body {
            margin: 0;
            padding: 0;
        }

        body {
            font: 14px 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.4em;
            background: #f5f5f5;
            color: #4d4d4d;
            min-width: 230px;
            max-width: 550px;
            margin: 0 auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-weight: 300;
        }

        .todoapp {
            background: #fff;
            margin: 130px 0 40px 0;
            position: relative;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2),
            0 25px 50px 0 rgba(0, 0, 0, 0.1);
        }

        .todoapp input::-webkit-input-placeholder {
            font-style: italic;
            font-weight: 300;
            color: #e6e6e6;
        }

        .todoapp input::-moz-placeholder {
            font-style: italic;
            font-weight: 300;
            color: #e6e6e6;
        }

        .todoapp input::input-placeholder {
            font-style: italic;
            font-weight: 300;
            color: #e6e6e6;
        }

        .todoapp h1 {
            position: absolute;
            top: -155px;
            width: 100%;
            font-size: 100px;
            font-weight: 100;
            text-align: center;
            color: rgba(175, 47, 47, 0.15);
            -webkit-text-rendering: optimizeLegibility;
            -moz-text-rendering: optimizeLegibility;
            text-rendering: optimizeLegibility;
        }

        .new-todo,
        .edit {
            position: relative;
            margin: 0;
            width: 100%;
            font-size: 20px;
            font-family: inherit;
            font-weight: inherit;
            line-height: 1.4em;
            color: inherit;
            padding: 6px;
            border: 1px solid #999;
            box-shadow: inset 0 -1px 5px 0 rgba(0, 0, 0, 0.2);
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .new-todo {
            padding: 16px 16px 16px 60px;
            border: none;
            background: rgba(0, 0, 0, 0.003);
            box-shadow: inset 0 -2px 1px rgba(0,0,0,0.03);
        }

        .main {
            position: relative;
            z-index: 2;
            border-top: 1px solid #e6e6e6;
        }

        .toggle-all {
            width: 1px;
            height: 1px;
            border: none;
            opacity: 0;
            position: absolute;
            right: 100%;
            bottom: 100%;
        }

        .toggle-all + label {
            width: 60px;
            height: 34px;
            font-size: 0;
            position: absolute;
            top: -52px;
            left: -13px;
            -webkit-transform: rotate(90deg);
            transform: rotate(90deg);
        }

        .toggle-all + label:before {
            content: '❯';
            font-size: 22px;
            color: #e6e6e6;
            padding: 10px 27px 10px 27px;
        }

        .toggle-all:checked + label:before {
            color: #737373;
        }

        .todo-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .todo-list li {
            position: relative;
            font-size: 20px;
            border-bottom: 1px solid #ededed;
        }

        .todo-list li:last-child {
            border-bottom: none;
        }

        .todo-list li.editing {
            border-bottom: none;
            padding: 0;
        }

        .todo-list li.editing .edit {
            display: block;
            width: 506px;
            padding: 12px 16px;
            margin: 0 0 0 43px;
        }

        .todo-list li.editing .view {
            display: none;
        }

        .todo-list li .toggle {
            text-align: center;
            width: 40px;
            height: auto;
            position: absolute;
            top: 0;
            bottom: 0;
            margin: auto 0;
            border: none;
            -webkit-appearance: none;
            appearance: none;
            opacity: 0;
        }

        .todo-list li .toggle + label {
            background-image: url('data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23ededed%22%20stroke-width%3D%223%22/%3E%3C/svg%3E');
            background-repeat: no-repeat;
            background-position: center left;
        }

        .todo-list li .toggle:checked + label {
            background-image: url('data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23bddad5%22%20stroke-width%3D%223%22/%3E%3Cpath%20fill%3D%22%235dc2af%22%20d%3D%22M72%2025L42%2071%2027%2056l-4%204%2020%2020%2034-52z%22/%3E%3C/svg%3E');
        }

        .todo-list li label {
            word-break: break-all;
            padding: 15px 15px 15px 60px;
            display: block;
            line-height: 1.2;
            transition: color 0.4s;
            /* Cursor style for drag and drop */
            cursor: move;
        }

        .todo-list li.completed label {
            color: #d9d9d9;
            text-decoration: line-through;
        }

        .todo-list li .destroy {
            display: none;
            position: absolute;
            top: 0;
            right: 10px;
            bottom: 0;
            width: 40px;
            height: 40px;
            margin: auto 0;
            font-size: 30px;
            color: #cc9a9a;
            margin-bottom: 11px;
            transition: color 0.2s ease-out;
            border: none;
            background: none;
            cursor: pointer;
        }

        .todo-list li .destroy:hover {
            color: #af5b5e;
        }

        .todo-list li .destroy:after {
            content: '×';
        }

        .todo-list li:hover .destroy {
            display: block;
        }

        .todo-list li .edit {
            display: none;
        }

        .todo-list li.editing:last-child {
            margin-bottom: -1px;
        }

        .footer {
            color: #777;
            padding: 10px 15px;
            height: 20px;
            text-align: center;
            border-top: 1px solid #e6e6e6;
        }

        .footer:before {
            content: '';
            position: absolute;
            right: 0;
            bottom: 0;
            left: 0;
            height: 50px;
            overflow: hidden;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2),
            0 8px 0 -3px #f6f6f6,
            0 9px 1px -3px rgba(0, 0, 0, 0.2),
            0 16px 0 -6px #f6f6f6,
            0 17px 2px -6px rgba(0, 0, 0, 0.2);
        }

        .todo-count {
            float: left;
            text-align: left;
        }

        .todo-count strong {
            font-weight: 300;
        }

        .filters {
            margin: 0;
            padding: 0;
            list-style: none;
            position: absolute;
            right: 0;
            left: 0;
        }

        .filters li {
            display: inline;
        }

        .filters li a {
            color: inherit;
            margin: 3px;
            padding: 3px 7px;
            text-decoration: none;
            border: 1px solid transparent;
            border-radius: 3px;
        }

        .filters li a:hover {
            border-color: rgba(175, 47, 47, 0.1);
        }

        .filters li a.selected {
            border-color: rgba(175, 47, 47, 0.2);
        }

        .clear-completed,
        html .clear-completed:active {
            float: right;
            position: relative;
            line-height: 20px;
            text-decoration: none;
            cursor: pointer;
            border: 0;
            background: none;
            font-size: 100%;
            vertical-align: baseline;
            font-family: inherit;
            font-weight: inherit;
            color: inherit;
            -webkit-appearance: none;
            appearance: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .clear-completed:hover {
            text-decoration: underline;
        }

        .info {
            margin: 65px auto 0;
            color: #bfbfbf;
            font-size: 10px;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
            text-align: center;
        }

        .info p {
            line-height: 1.5;
        }

        .info a {
            color: inherit;
            text-decoration: none;
            font-weight: 400;
        }

        .info a:hover {
            text-decoration: underline;
        }

        /* Sorting specific styles */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #f9f9f9;
        }

        .sortable-drag {
            cursor: grabbing;
        }

        .disabled-sort-notice {
            position: absolute;
            top: -25px;
            right: 0;
            font-size: 12px;
            color: #999;
        }
    </style>

    <script>
        window.onload = function () {
            // Register VueDraggable
            // CDN exports it as 'vuedraggable'
            Vue.component('draggable', vuedraggable);

            // LocalStorage Persistence
            var STORAGE_KEY = localStorage.getItem('todos-key') || 'todos-vuejs-2.0';

            var todoStorage = {
                fetch: function () {
                    var todos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                    todos.forEach(function (todo, index) {
                        todo.id = index;
                    });
                    todoStorage.uid = todos.length;
                    return todos;
                },
                save: function (todos) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
                }
            };

            // Switch Key Logic (Multi-tenancy)
            document.getElementById("changekey").onclick = function () {
                var index = this.dataset['index'];
                index = (index == null || index >= 3) ? 0 : parseInt(index) + 1;

                this.dataset['index'] = index;
                var groups = ['todos-vuejs-2.0', 'todos-group-1', 'todos-group-2', 'todos-group-3'];

                STORAGE_KEY = groups[index];
                localStorage.setItem('todos-key', STORAGE_KEY);
                document.getElementById("task").innerHTML = STORAGE_KEY;

                app.todos = todoStorage.fetch();
            };

            // Filters
            var filters = {
                all: function (todos) {
                    return todos;
                },
                active: function (todos) {
                    return todos.filter(function (todo) {
                        return !todo.completed;
                    });
                },
                completed: function (todos) {
                    return todos.filter(function (todo) {
                        return todo.completed;
                    });
                }
            };

            var app = new Vue({
                data: {
                    todos: todoStorage.fetch(),
                    newTodo: '',
                    editedTodo: null,
                    visibility: 'all'
                },

                watch: {
                    todos: {
                        handler: function (todos) {
                            todoStorage.save(todos);
                        },
                        deep: true
                    }
                },

                computed: {
                    filteredTodos: function () {
                        return filters[this.visibility](this.todos);
                    },
                    remaining: function () {
                        return filters.active(this.todos).length;
                    },
                    allDone: {
                        get: function () {
                            return this.remaining === 0;
                        },
                        set: function (value) {
                            this.todos.forEach(function (todo) {
                                todo.completed = value;
                            });
                        }
                    }
                },

                filters: {
                    pluralize: function (n) {
                        return n === 1 ? 'item' : 'items';
                    }
                },

                methods: {
                    addTodo: function () {
                        var value = this.newTodo && this.newTodo.trim();
                        if (!value) {
                            return;
                        }
                        this.todos.push({
                            id: todoStorage.uid++,
                            title: value,
                            completed: false
                        });
                        this.newTodo = '';
                    },

                    removeTodo: function (todo) {
                        if (confirm("Are you sure you want to delete this task?")) {
                            this.todos.splice(this.todos.indexOf(todo), 1);
                        }
                    },

                    editTodo: function (todo) {
                        this.beforeEditCache = todo.title;
                        this.editedTodo = todo;
                    },

                    doneEdit: function (todo) {
                        if (!this.editedTodo) {
                            return;
                        }
                        this.editedTodo = null;
                        todo.title = todo.title.trim();
                        if (!todo.title) {
                            this.removeTodo(todo);
                        }
                    },

                    cancelEdit: function (todo) {
                        this.editedTodo = null;
                        todo.title = this.beforeEditCache;
                    },

                    removeCompleted: function () {
                        if (confirm("Are you sure you want to clear completed tasks?")) {
                            this.todos = filters.active(this.todos);
                        }
                    }
                },

                directives: {
                    'todo-focus': function (el, binding) {
                        if (binding.value) {
                            el.focus();
                        }
                    }
                }
            });

            function onHashChange() {
                var visibility = window.location.hash.replace(/#\/?/, '');
                if (filters[visibility]) {
                    app.visibility = visibility;
                } else {
                    window.location.hash = '';
                    app.visibility = 'all';
                }
            }

            window.addEventListener('hashchange', onHashChange);
            onHashChange();

            // Initialization
            app.$mount('.todoapp');

            // Initial label update for task group
            var currentKey = localStorage.getItem('todos-key');
            if(currentKey) {
                document.getElementById("task").innerHTML = currentKey;
                var groups = ['todos-vuejs-2.0', 'todos-group-1', 'todos-group-2', 'todos-group-3'];
                var idx = groups.indexOf(currentKey);
                if(idx > -1) {
                    document.getElementById("changekey").dataset['index'] = idx;
                }
            }
        };
    </script>
</head>
<body>
<section class="todoapp">
    <header class="header">
        <h1>todos</h1>
        <input class="new-todo"
               autofocus autocomplete="off"
               placeholder="What needs to be done?"
               v-model="newTodo"
               @keyup.enter="addTodo">
        <div class="disabled-sort-notice" v-if="visibility !== 'all' && todos.length > 0">
            Sorting disabled while filtering
        </div>
    </header>

    <section class="main" v-show="todos.length" v-cloak>
        <input class="toggle-all" type="checkbox" v-model="allDone" id="toggle-all">
        <label for="toggle-all">Mark all as complete</label>

        <!--
          Sorting Logic:
          We use <draggable> only when visibility is 'all' to ensure the main array index matches the visual order.
          When filtered, we fall back to a standard <ul>.
        -->

        <!-- Draggable List (All) -->
        <draggable
                v-if="visibility === 'all'"
                v-model="todos"
                tag="ul"
                class="todo-list"
                handle=".view"
                ghost-class="sortable-ghost"
                drag-class="sortable-drag"
                animation="200"
        >
            <li v-for="todo in todos"
                class="todo"
                :key="todo.id"
                :class="{ completed: todo.completed, editing: todo == editedTodo }">
                <div class="view" title="Drag to reorder">
                    <input class="toggle" type="checkbox" v-model="todo.completed">
                    <label @dblclick="editTodo(todo)">{{ todo.title }}</label>
                    <button class="destroy" @click="removeTodo(todo)"></button>
                </div>
                <input class="edit" type="text"
                       v-model="todo.title"
                       v-todo-focus="todo == editedTodo"
                       @blur="doneEdit(todo)"
                       @keyup.enter="doneEdit(todo)"
                       @keyup.esc="cancelEdit(todo)">
            </li>
        </draggable>

        <!-- Static List (Active/Completed) -->
        <ul v-else class="todo-list">
            <li v-for="todo in filteredTodos"
                class="todo"
                :key="todo.id"
                :class="{ completed: todo.completed, editing: todo == editedTodo }">
                <div class="view" style="cursor: default;">
                    <input class="toggle" type="checkbox" v-model="todo.completed">
                    <label @dblclick="editTodo(todo)" style="cursor: default;">{{ todo.title }}</label>
                    <button class="destroy" @click="removeTodo(todo)"></button>
                </div>
                <input class="edit" type="text"
                       v-model="todo.title"
                       v-todo-focus="todo == editedTodo"
                       @blur="doneEdit(todo)"
                       @keyup.enter="doneEdit(todo)"
                       @keyup.esc="cancelEdit(todo)">
            </li>
        </ul>

    </section>

    <footer class="footer" v-show="todos.length" v-cloak>
            <span class="todo-count">
                <strong>{{ remaining }}</strong> {{ remaining | pluralize }} left
            </span>
        <ul class="filters">
            <li><a href="#/all" :class="{ selected: visibility == 'all' }">All</a></li>
            <li><a href="#/active" :class="{ selected: visibility == 'active' }">Active</a></li>
            <li><a href="#/completed" :class="{ selected: visibility == 'completed' }">Completed</a></li>
        </ul>
        <button class="clear-completed" @click="removeCompleted" v-show="todos.length > remaining">
            Clear completed
        </button>
    </footer>
</section>

<footer class="info">
    <p>Drag and drop items to sort (in 'All' view)</p>
    <p>Double-click to edit a todo</p>
    <p style="position: fixed; right: 10px; top: 20px;">
        <a href="javascript:void(0)" id="changekey" data-index="0">Switch Task (<span id="task">default</span>)</a>
    </p>
</footer>
</body>
</html>